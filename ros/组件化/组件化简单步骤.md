
---

## ğŸš€ åˆ›å»ºä¸€ä¸ªã€Œç»„ä»¶åŒ– + ç”Ÿå‘½å‘¨æœŸã€ROS 2 èŠ‚ç‚¹çš„æ­¥éª¤æ€»ç»“

---

### **1ï¸âƒ£ åˆ›å»ºåŠŸèƒ½åŒ…**

åœ¨å·¥ä½œç©ºé—´ä¸‹ï¼š

```bash
ros2 pkg create my_node_name --build-type ament_cmake --dependencies rclcpp rclcpp_lifecycle rclcpp_components
```

> ğŸ’¡ è‹¥èŠ‚ç‚¹ä¼šå‘å¸ƒ/è®¢é˜…æ¶ˆæ¯ï¼Œè¿˜è¦åŠ ä¸Šä¾èµ–ï¼š
> `nav_msgs sensor_msgs geometry_msgs std_msgs` ç­‰ã€‚

---

### **2ï¸âƒ£ åˆ›å»ºç›®å½•ç»“æ„**

```
my_node_name/
â”œâ”€â”€ include/
â”‚   â””â”€â”€ my_node_name/
â”‚       â””â”€â”€ my_node_component.hpp     â† å¤´æ–‡ä»¶ï¼ˆç±»å®šä¹‰ï¼‰
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ my_node_component.cpp         â† æºæ–‡ä»¶ï¼ˆç±»å®ç°ï¼‰
â”‚   â””â”€â”€ main.cpp                      â† ä¸»å‡½æ•°ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ package.xml
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ plugin.xml
```

---

### **3ï¸âƒ£ åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰ç»„ä»¶ç±»**

ï¼ˆä¾‹å¦‚ï¼š`include/my_node_name/my_node_component.hpp`ï¼‰

åŸºæœ¬æ¨¡å¼ï¼š

```cpp
#pragma once
#include "rclcpp/rclcpp.hpp"
#include "rclcpp_lifecycle/lifecycle_node.hpp"

namespace my_node_name
{

class MyNodeComponent : public rclcpp_lifecycle::LifecycleNode
{
public:
  explicit MyNodeComponent(const rclcpp::NodeOptions & options);

protected:
  // ç”Ÿå‘½å‘¨æœŸå›è°ƒå‡½æ•°
  rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn on_configure(const rclcpp_lifecycle::State &);
  rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn on_activate(const rclcpp_lifecycle::State &);
  rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn on_deactivate(const rclcpp_lifecycle::State &);
  rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn on_cleanup(const rclcpp_lifecycle::State &);

private:
  // æˆå‘˜å˜é‡ä¸å›è°ƒå‡½æ•°
};

}  // namespace my_node_name
```

---

### **4ï¸âƒ£ åœ¨æºæ–‡ä»¶ä¸­å®ç°ç±»**

ï¼ˆä¾‹å¦‚ï¼š`src/my_node_component.cpp`ï¼‰

æ ¸å¿ƒç»“æ„ï¼š

```cpp
#include "my_node_name/my_node_component.hpp"

namespace my_node_name
{

MyNodeComponent::MyNodeComponent(const rclcpp::NodeOptions & options)
: rclcpp_lifecycle::LifecycleNode("my_node_component", options)
{
}

rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn
MyNodeComponent::on_configure(const rclcpp_lifecycle::State &)
{
  RCLCPP_INFO(get_logger(), "Configuring...");
  // å£°æ˜å‚æ•°ã€åˆ›å»ºè®¢é˜…è€…å’Œå‘å¸ƒè€…ç­‰
  return CallbackReturn::SUCCESS;
}

rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn
MyNodeComponent::on_activate(const rclcpp_lifecycle::State &)
{
  RCLCPP_INFO(get_logger(), "Activating...");
  // æ¿€æ´»publisherã€å¯åŠ¨timerç­‰
  return CallbackReturn::SUCCESS;
}

rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn
MyNodeComponent::on_deactivate(const rclcpp_lifecycle::State &)
{
  RCLCPP_INFO(get_logger(), "Deactivating...");
  // åœæ­¢timerç­‰
  return CallbackReturn::SUCCESS;
}

rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn
MyNodeComponent::on_cleanup(const rclcpp_lifecycle::State &)
{
  RCLCPP_INFO(get_logger(), "Cleaning up...");
  // é‡Šæ”¾èµ„æº
  return CallbackReturn::SUCCESS;
}

}  // namespace my_node_name

#include "rclcpp_components/register_node_macro.hpp"
RCLCPP_COMPONENTS_REGISTER_NODE(my_node_name::MyNodeComponent)
```

> ğŸ”¹ æ³¨æ„ï¼šæœ€åä¸€å®šè¦åŠ ä¸Š `RCLCPP_COMPONENTS_REGISTER_NODE(...)`ï¼Œ
> å¦åˆ™æ— æ³•ä½œä¸ºç»„ä»¶è¢«åŠ è½½ã€‚

---

### **5ï¸âƒ£ ï¼ˆå¯é€‰ï¼‰æ·»åŠ  main.cpp æ–‡ä»¶**

å¦‚æœå¸Œæœ›èŠ‚ç‚¹æ—¢èƒ½è¢«ç»„ä»¶åŠ è½½ï¼Œä¹Ÿèƒ½ç‹¬ç«‹è¿è¡Œï¼š

```cpp
#include "rclcpp/rclcpp.hpp"
#include "my_node_name/my_node_component.hpp"

int main(int argc, char ** argv)
{
  rclcpp::init(argc, argv);
  auto options = rclcpp::NodeOptions();
  auto node = std::make_shared<my_node_name::MyNodeComponent>(options);

  node->configure();
  node->activate();
  
  rclcpp::spin(node->get_node_base_interface());
  rclcpp::shutdown();
  return 0;
}
```

---

### **ï¼ˆå¿…åšï¼‰æ·»åŠ plugin.xmlçš„å†…å®¹**


```bash
<library path="my_node_component">
  <class 
    name="my_node_name::MyNodeComponent" 
    type="my_node_name::MyNodeComponent" 
    base_class_type="rclcpp_components::NodeFactory">
    <description>Robot Component</description>
  </class>
</library>
```

---
### **6ï¸âƒ£ ä¿®æ”¹ CMakeLists.txt**

æ ¸å¿ƒéƒ¨åˆ†ï¼š

```cmake
find_package(rclcpp REQUIRED)
find_package(rclcpp_lifecycle REQUIRED)
find_package(rclcpp_components REQUIRED)

include_directories(include)

# ç»„ä»¶åº“
add_library(${PROJECT_NAME}_component SHARED
  src/my_node_component.cpp
)
ament_target_dependencies(${PROJECT_NAME}_component
  rclcpp
  rclcpp_lifecycle
  rclcpp_components
)
rclcpp_components_register_nodes(${PROJECT_NAME}_component "my_node_name::MyNodeComponent")

# å¯æ‰§è¡ŒèŠ‚ç‚¹ï¼ˆå¯é€‰ï¼‰
add_executable(${PROJECT_NAME}_node src/main.cpp)
target_link_libraries(${PROJECT_NAME}_node ${PROJECT_NAME}_component)

ament_target_dependencies(${PROJECT_NAME}_node 
  rclcpp 
  rclcpp_lifecycle 
)

# å®‰è£…åº“
install(TARGETS 
  ${PROJECT_NAME}_component
  ARCHIVE DESTINATION lib
  LIBRARY DESTINATION lib
  RUNTIME DESTINATION bin
)

install(
  FILES plugin.xml
  DESTINATION share/${PROJECT_NAME}
)

# å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶
install(TARGETS
  ${PROJECT_NAME}_node
  RUNTIME DESTINATION lib/${PROJECT_NAME} 
)

# å®‰è£…æ–‡ä»¶å¤¹
install(DIRECTORY include/
  DESTINATION include/
)

install(DIRECTORY config launch
  DESTINATION share/${PROJECT_NAME}
)

ament_package()
```

---

### **7ï¸âƒ£ ç¼–è¯‘**

```bash
cd ~/ros2_ws
colcon build --packages-select my_node_name
source install/setup.bash
```

---

### **8ï¸âƒ£ è¿è¡ŒèŠ‚ç‚¹**

ä¸¤ç§æ–¹å¼ ğŸ‘‡

#### âœ… ç‹¬ç«‹è¿è¡Œ

```bash
ros2 run my_node_name my_node_name_node
```

#### âœ… ç»„ä»¶åŠ è½½æ–¹å¼

```bash
ros2 component standalone my_node_name my_node_name::my_node_component
```

---

### **ğŸ” æ€»ç»“ï¼šæ ¸å¿ƒæ€è·¯**

| æ¨¡å—                      | å†…å®¹                                              | ä½œç”¨     |
| ----------------------- | ----------------------------------------------- | ------ |
| **LifecycleNode ç»§æ‰¿**    | æ§åˆ¶èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸï¼ˆconfigure/activate/deactivate/cleanupï¼‰ | èŠ‚ç‚¹è¿è¡Œç®¡ç† |
| **rclcpp_components**   | å°†èŠ‚ç‚¹ç¼–è¯‘ä¸ºç»„ä»¶åº“ï¼Œå¯è¢«åŠ¨æ€åŠ è½½                                | æ¨¡å—åŒ–è®¾è®¡  |
| **register_node_macro** | `RCLCPP_COMPONENTS_REGISTER_NODE()`             | æ³¨å†Œç»„ä»¶   |
| **main.cppï¼ˆå¯é€‰ï¼‰**        | è®©ç»„ä»¶å¯ç‹¬ç«‹è¿è¡Œ                                        | å¼€å‘è°ƒè¯•æ–¹ä¾¿ |

---

