
# âœ… æ–¹æ¡ˆä¸€ï¼š**MJPG-streamer**

## ğŸ§° ä¸€ã€å®‰è£… MJPG-streamerï¼ˆæºç ï¼‰

å®˜ç½‘ï¼šhttps://github.com/jacksonliam/mjpg-streamer

å®‰è£…ä¾èµ–ï¼š

```bash
sudo apt update
sudo apt-get install cmake libjpeg8-dev

# å¦‚æœè¿˜æ²¡å®‰è£…gcc
sudo apt-get install gcc g++
```
ä¸‹è½½æºç å¹¶ç¼–è¯‘ï¼š
```bash
git clone https://github.com/jacksonliam/mjpg-streamer.git

cd mjpg-streamer/mjpg-streamer-experimental
make
sudo make install
```

ä½¿ç”¨ï¼š
```bash
# åœ¨mjpeg-streamer-experimentalæ–‡ä»¶å¤¹è¿è¡Œ
export LD_LIBRARY_PATH=.
./mjpg_streamer -o "output_http.so -w ./www" -i "input_uvc.so"
./mjpg_streamer -o "output_http.so -w ./www" -i "input_raspicam.so"

# æˆ–è€…ç›´æ¥è¿è¡Œ
mjpg_streamer -i "input_uvc.so -d /dev/video0 -r 640x480 -f 30" -o "output_http.so -w ./www -p 8080"

# åå°é•¿æœŸè¿è¡Œ
nohup mjpg_streamer -i "input_uvc.so -d /dev/video0 -r 640x480 -f 30" -o "output_http.so -w ./www -p 8080" > /dev/null 2>&1 &
```
---

## ğŸš€ äºŒã€å¯åŠ¨ MJPG-streamer æœåŠ¡

æ’ä¸Šæ‘„åƒå¤´ï¼Œå…ˆç¡®è®¤è®¾å¤‡è¯†åˆ«ï¼š

```bash
ls /dev/video*
```

åº”çœ‹åˆ° `/dev/video0`ã€‚

ç„¶åå¯åŠ¨è§†é¢‘æµï¼š

```bash
mjpg_streamer -i "input_uvc.so -d /dev/video0 -r 640x480 -f 30" -o "output_http.so -w /usr/local/www -p 8080"
```

### å‚æ•°è§£é‡Šï¼š

| å‚æ•°               | å«ä¹‰               |
| ---------------- | ---------------- |
| `-d /dev/video0` | æ‘„åƒå¤´è®¾å¤‡è·¯å¾„          |
| `-r 640x480`     | åˆ†è¾¨ç‡ï¼ˆå¯æ”¹ä¸º1280x720ï¼‰ |
| `-f 30`          | å¸§ç‡               |
| `-p 8080`        | HTTPæœåŠ¡ç«¯å£         |

---

## ğŸŒ ä¸‰ã€åœ¨ç”µè„‘ä¸ŠæŸ¥çœ‹ç”»é¢

åœ¨ä½ çš„ç”µè„‘æµè§ˆå™¨è¾“å…¥ï¼š

```
http://<æ ‘è“æ´¾IP>:8080
```

ï¼ˆä¾‹å¦‚ï¼š`http://192.168.1.88:8080`ï¼‰

ä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªç½‘é¡µï¼Œä¸Šé¢æ˜¯å®æ—¶æ‘„åƒå¤´ç”»é¢ã€‚ğŸ¥

---

<br>
<br>

# âœ… æ–¹æ¡ˆäºŒï¼š**Python å®æ—¶æ¨æµ**

ç”¨ Python é‡‡å›¾ + ç›®æ ‡è¯†åˆ« + Flask ç½‘é¡µæ¨æµï¼Œ
åœ¨æµè§ˆå™¨é‡Œçœ‹â€œè¯†åˆ«åç”»é¢â€ã€‚

---

### ğŸ”§ å®‰è£…ä¾èµ–ï¼š

åœ¨æ ‘è“æ´¾ä¸Šè¿è¡Œï¼š

```bash
sudo apt update
sudo apt install python3-opencv python3-flask -y
```

---

### ğŸ§  ç¤ºä¾‹ä»£ç ï¼š`object_stream.py`

ä¸‹é¢è¿™æ®µè„šæœ¬ä¼šï¼š

1. ä» USB æ‘„åƒå¤´è¯»å–ç”»é¢ï¼›
2. å°†å›¾åƒè½¬æˆç°åº¦ï¼›
3. åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºå¤„ç†åçš„å›¾åƒæµã€‚

```python
from flask import Flask, Response
import cv2

app = Flask(__name__)

# æ‰“å¼€æ‘„åƒå¤´ï¼ˆä½ ä¹Ÿå¯ä»¥æ”¹æˆåˆ«çš„è®¾å¤‡å·ï¼Œæ¯”å¦‚ /dev/video1ï¼‰
camera = cv2.VideoCapture(0)

def generate_frames():
    while True:
        success, frame = camera.read()
        if not success:
            break
        else:
            # è½¬ç°åº¦
            gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
            # å†è½¬å› BGR æ ¼å¼ï¼Œå¦åˆ™æµè§ˆå™¨æ— æ³•æ˜¾ç¤º
            gray_bgr = cv2.cvtColor(gray, cv2.COLOR_GRAY2BGR)

            # ç¼–ç ä¸º JPEG æ ¼å¼å­—èŠ‚æµ
            ret, buffer = cv2.imencode('.jpg', gray_bgr)
            frame = buffer.tobytes()

            # è¾“å‡º HTTP æµ
            yield (b'--frame\r\n'
                   b'Content-Type: image/jpeg\r\n\r\n' + frame + b'\r\n')

@app.route('/video')
def video():
    return Response(generate_frames(),
                    mimetype='multipart/x-mixed-replace; boundary=frame')

@app.route('/')
def index():
    return '<h2>ç°åº¦æ‘„åƒå¤´æµ</h2><img src="/video" width="640" />'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)

```

---

### ğŸš€ è¿è¡Œï¼š

```bash
python3 object_stream.py
```

ç„¶ååœ¨ç”µè„‘æµè§ˆå™¨ä¸­è®¿é—®ï¼š

```
http://<æ ‘è“æ´¾IP>:8080
```

å°±èƒ½çœ‹åˆ° **ç°åº¦å®æ—¶è§†é¢‘æµ**ï¼

---