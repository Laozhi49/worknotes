在树莓派（或 Ubuntu 系统）上修改 `50-cloud-init.yaml` 后重启被恢复，通常是因为 **cloud-init** 在每次启动时重新生成网络配置。以下是解决方案：

---

### **1. 禁用 cloud-init 的网络配置（推荐）**
cloud-init 默认会覆盖 Netplan 配置，需禁止它管理网络：
```bash
sudo nano /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg
```
添加以下内容：
```yaml
network: {config: disabled}
```
保存后运行：
```bash
sudo cloud-init clean     # 清理缓存
sudo netplan generate     # 重新生成 Netplan 配置
sudo netplan apply        # 应用配置
```
运行sudo netplan apply报错时，

检查并启动 systemd-networkd
```bash
# 检查服务状态
sudo systemctl status systemd-networkd

# 如果未运行，启动并启用服务
sudo systemctl enable --now systemd-networkd
```

---

### **2. 直接修改 cloud-init 的源配置**
如果仍需保留 cloud-init，但想永久修改配置：
```bash
sudo nano /etc/cloud/cloud.cfg
```
找到 `network:` 部分，确保其值为 `disabled` 或注释掉相关配置：
```yaml
network:
  config: disabled
```

---

### **3. 替换默认的 `50-cloud-init.yaml`**
删除或重命名原文件，创建自定义配置：
```bash
sudo mv /etc/netplan/50-cloud-init.yaml /etc/netplan/50-cloud-init.yaml.bak  # 备份
sudo nano /etc/netplan/01-custom.yaml
```
写入你的静态 IP 或 Wi-Fi 配置（示例）：
```yaml
network:
  version: 2
  renderer: networkd
  ethernets:
    eth0:
      dhcp4: no
      addresses: [192.168.1.100/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
```
应用配置：
```bash
sudo netplan apply
```

---

### **4. 锁定 Netplan 文件防止覆盖**
使用 `chattr` 禁止修改文件：
```bash
sudo chattr +i /etc/netplan/01-custom.yaml  # 加锁
sudo chattr -i /etc/netplan/01-custom.yaml  # 解锁（如需编辑）
```

---

### **5. 检查 cloud-init 服务状态**
确保 cloud-init 不会在下次启动时重置配置：
```bash
sudo systemctl disable cloud-init  # 禁用服务（谨慎操作）
sudo systemctl mask cloud-init     # 彻底屏蔽
```

---

### **验证是否生效**
1. 修改配置后，手动触发重启：
   ```bash
   sudo reboot
   ```
2. 重启后检查配置：
   ```bash
   cat /etc/netplan/01-custom.yaml  # 确认文件未恢复
   ip a show eth0                   # 检查 IP 是否生效
   ```

---

### **关键点总结**
| 问题原因 | 解决方案 |
|----------|----------|
| cloud-init 自动覆盖配置 | 禁用其网络管理功能（`network: {config: disabled}`） |
| 默认配置文件优先级低 | 创建更高优先级的文件（如 `01-custom.yaml`） |
| 文件权限被重置 | 使用 `chattr +i` 锁定文件 |

如果仍有问题，可能是系统镜像预装了强制恢复机制（如 Raspberry Pi OS 的 `raspi-config`），建议检查 `/etc/rc.local` 或 `cron` 任务中是否有重置脚本。